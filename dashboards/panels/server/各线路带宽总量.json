{
    "datasource": {
        "default": false,
        "type": "mysql",
        "uid": "{{MYSQL_UID}}"
    },
    "fieldConfig": {
        "defaults": {
            "color": {
                "mode": "thresholds"
            },
            "custom": {
                "align": "auto",
                "cellOptions": {
                    "type": "auto"
                },
                "inspect": false
            },
            "mappings": [],
            "thresholds": {
                "mode": "absolute",
                "steps": [
                    {
                        "color": "green",
                        "value": null
                    },
                    {
                        "color": "red",
                        "value": 80
                    }
                ]
            }
        },
        "overrides": [
            {
                "matcher": {
                    "id": "byName",
                    "options": "各线路带宽使用率"
                },
                "properties": [
                    {
                        "id": "unit",
                        "value": "percent"
                    }
                ]
            },
            {
                "matcher": {
                    "id": "byName",
                    "options": "线路"
                },
                "properties": [
                    {
                        "id": "custom.width",
                        "value": 318
                    }
                ]
            }
        ]
    },
    "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 49
    },
    "id": 1,
    "options": {
        "cellHeight": "sm",
        "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
                "sum"
            ],
            "show": false
        },
        "showHeader": true,
        "sortBy": []
    },
    "pluginVersion": "11.2.2",
    "targets": [
        {
            "dataset": "iptunnel",
            "datasource": {
                "type": "mysql",
                "uid": "{{MYSQL_UID}}"
            },
            "editorMode": "code",
            "format": "table",
            "rawQuery": true,
            "rawSql": "SELECT bandwidth_line_code, total_bandwidth FROM bandwidth_lines WHERE is_active=1 AND deleted_at IS NULL AND bandwidth_line_code LIKE ${bandwidth_line:singlequote}",
            "refId": "A",
            "sql": {
                "columns": [
                    {
                        "parameters": [],
                        "type": "function"
                    }
                ],
                "groupBy": [
                    {
                        "property": {
                            "type": "string"
                        },
                        "type": "groupBy"
                    }
                ],
                "limit": 50
            }
        },
        {
            "dataset": "iptunnel",
            "datasource": {
                "type": "mysql",
                "uid": "{{MYSQL_UID}}"
            },
            "editorMode": "code",
            "format": "table",
            "hide": false,
            "rawQuery": true,
            "rawSql": "SELECT bandwidth_line_code, user_code, SUM(bandwidth) FROM configs WHERE status='active' AND deleted_at IS NULL AND bandwidth_line_code LIKE ${bandwidth_line:singlequote} GROUP BY bandwidth_line_code, user_code",
            "refId": "B",
            "sql": {
                "columns": [
                    {
                        "parameters": [],
                        "type": "function"
                    }
                ],
                "groupBy": [
                    {
                        "property": {
                            "type": "string"
                        },
                        "type": "groupBy"
                    }
                ],
                "limit": 50
            }
        }
    ],
    "title": "各线路带宽总量（Mbps）",
    "transformations": [
        {
            "id": "joinByField",
            "options": {
                "byField": "bandwidth_line_code",
                "mode": "outerTabular"
            }
        },
        {
            "id": "calculateField",
            "options": {
                "binary": {
                    "left": "SUM(bandwidth)",
                    "operator": "/",
                    "right": "total_bandwidth"
                },
                "mode": "binary",
                "reduce": {
                    "reducer": "sum"
                }
            }
        },
        {
            "id": "calculateField",
            "options": {
                "binary": {
                    "left": "SUM(bandwidth) / total_bandwidth",
                    "operator": "*",
                    "right": "100"
                },
                "mode": "binary",
                "reduce": {
                    "reducer": "sum"
                }
            }
        },
        {
            "id": "organize",
            "options": {
                "excludeByName": {
                    "SUM(bandwidth) / total_bandwidth": true,
                    "user_code": true
                },
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                    "SUM(bandwidth)": "带宽购买情况（Mbps）",
                    "SUM(bandwidth) / total_bandwidth": "",
                    "SUM(bandwidth) / total_bandwidth * 100": "各线路带宽使用率",
                    "bandwidth_line_code": "线路",
                    "total_bandwidth": "带宽总量（Mbps）"
                }
            }
        }
    ],
    "type": "table"
}